<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Beemote IA</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource-variable/inter/index.css">
  <script src="https://cdn.jsdelivr.net/npm/@huggingface/transformers@4.9.2/dist/transformers.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter Variable', sans-serif;
      background: #0d1117;
      color: #e6edf3;
      display: flex; height: 100vh; overflow: hidden;
    }
    .sidebar {
      width: 250px; background: #161b22; padding: 20px;
      transition: transform 0.3s ease; overflow-y: auto;
    }
    .sidebar.hidden { transform: translateX(-100%); }
    .toggle-btn {
      position: absolute; left: 10px; top: 10px; background: #21262d;
      color: white; border: none; padding: 10px; cursor: pointer;
    }
    .main { flex: 1; display: flex; flex-direction: column; }
    .chat-window {
      flex: 1; padding: 20px; overflow-y: auto;
      display: flex; flex-direction: column; gap: 12px;
    }
    .input-area {
      display: flex; border-top: 1px solid #30363d; padding: 10px;
    }
    textarea {
      flex: 1; resize: none; padding: 12px;
      background: #0d1117; border: 1px solid #30363d;
      color: #e6edf3; border-radius: 8px;
    }
    button.send-btn {
      background: #238636; color: white;
      border: none; margin-left: 10px; padding: 10px 16px;
      border-radius: 8px; cursor: pointer;
    }
    .msg.user { align-self: flex-end; background: #1f6feb; padding: 10px 14px; border-radius: 10px; max-width: 80%; }
    .msg.bot { align-self: flex-start; background: #30363d; padding: 10px 14px; border-radius: 10px; max-width: 80%; }
    @media (max-width: 768px) {
      .sidebar { position: absolute; height: 100%; z-index: 10; }
    }
  </style>
</head>
<body>

  <div class="sidebar hidden" id="sidebar">
    <h2>Beemote IA</h2>
    <p>Histórico de mensagens (em breve)</p>
  </div>

  <div class="main">
    <button class="toggle-btn" onclick="toggleSidebar()">☰</button>
    <div class="chat-window" id="chat"></div>
    <div class="input-area">
      <textarea id="userInput" rows="2" placeholder="Escreva sua pergunta..."></textarea>
      <button class="send-btn" onclick="sendMessage()">Enviar</button>
    </div>
  </div>

  <script>
    const chat = document.getElementById('chat');
    const userInput = document.getElementById('userInput');
    const sidebar = document.getElementById('sidebar');

    // Inicializando o modelo do HuggingFace com transformers.js
    let model, tokenizer;

    async function loadModel() {
      model = await window.huggingface.loadModel("Xenova/distilbert-portuguese"); // Modelo em português
      tokenizer = await window.huggingface.loadTokenizer("Xenova/distilbert-portuguese");
    }

    function toggleSidebar() {
      sidebar.classList.toggle('hidden');
    }

    function appendMessage(text, sender = 'user') {
      const div = document.createElement('div');
      div.className = `msg ${sender}`;
      div.textContent = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    async function sendMessage() {
      const message = userInput.value.trim();
      if (!message) return;
      appendMessage(message, 'user');
      userInput.value = '';

      appendMessage('Digitando...', 'bot');

      // Tokenize e processa a mensagem no modelo
      const inputs = tokenizer.encode(message);
      const response = await model.generate(inputs, { maxLength: 50 });
      const decodedResponse = tokenizer.decode(response[0]);

      // Mostra a resposta
      document.querySelector('.msg.bot:last-child').textContent = decodedResponse;
    }

    // Carrega o modelo assim que o script for carregado
    loadModel();
  </script>

</body>
</html>
